import E from"https://js.arcgis.com/4.30/@arcgis/core/Map.js";import w from"https://js.arcgis.com/4.30/@arcgis/core/views/MapView.js";import b from"https://js.arcgis.com/4.30/@arcgis/core/layers/GeoJSONLayer.js";import B from"https://js.arcgis.com/4.30/@arcgis/core/layers/GraphicsLayer.js";import T from"https://js.arcgis.com/4.30/@arcgis/core/Graphic.js";import L from"https://js.arcgis.com/4.30/@arcgis/core/symbols/SimpleFillSymbol.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function i(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(o){if(o.ep)return;o.ep=!0;const l=i(o);fetch(o.href,l)}})();window._highlightHandle=null;window._selectedStates=[];let n=0,g=[],c=-1;const f=new E({basemap:"osm"}),a=new w({container:"viewDiv",map:f,center:[-98,39],zoom:4}),d=new b({url:"./data/states.geojson",title:"US States"});f.add(d);const m=new B;f.add(m);a.ui.move("zoom","bottom-right");document.getElementById("helpButton").addEventListener("click",()=>{console.log("Help button clicked.");const t=document.getElementById("myModal");t.style.display=t.style.display==="none"?"block":"none",gtag("event","click",{event_category:"Toolbar",event_label:"Help Button",value:1})});let s=!0;document.getElementById("toggleStatesBtn").addEventListener("click",()=>{s=!s,d.visible=s,gtag("event","click",{event_category:"Toolbar",event_label:"Toggle States Layer",value:s?1:0})});const v=document.getElementById("stateSearchBox"),p=document.getElementById("searchButton");function h(t,e){const i=new T({geometry:t.geometry,symbol:new L({color:[255,255,0,.4],outline:{color:[255,255,0],width:2}})});m.add(i);let r=0;const o=3,l=setInterval(()=>{i.visible=!i.visible,r++,r>=o*2&&(clearInterval(l),m.remove(i))},300)}p.addEventListener("click",()=>{const t=v.value.trim().toLowerCase();t&&d.queryFeatures({where:`LOWER(STATE_NAME) LIKE '${t}%'`,returnGeometry:!0,outFields:["*"]}).then(e=>{if(e.features.length===0){alert("No states found."),y(0);return}window._selectedStates=e.features.map(r=>r.clone()),a.whenLayerView(d).then(r=>{window._highlightHandle&&window._highlightHandle.remove(),window._highlightHandle=r.highlight(e.features)}),e.features.forEach(r=>h(r));const i=e.features.map(r=>r.geometry.extent).reduce((r,o)=>r.union(o));a.goTo(i.expand(1)),y(e.features.length),gtag("event","search",{event_category:"Toolbar",event_label:`State Search: ${t}`,value:e.features.length})})});v.addEventListener("keydown",t=>{t.key==="Enter"&&p.click(),n=0});function y(t){const e=document.getElementById("selectionCountBtn");e.textContent=t,t>0?(e.classList.add("active"),e.disabled=!1):(e.classList.remove("active"),e.disabled=!0)}document.getElementById("tourButton").addEventListener("click",()=>{console.log("You clicked the Tour button");const t=window._selectedStates||[];if(!t.length){alert("No selected states to tour.");return}n>=t.length&&(n=0),console.log("Tour index = "+n);const e=t[n];if(!e||!e.geometry||!e.geometry.extent){console.error("Invalid feature in tour:",n,e);return}console.log(`Touring ${e.attributes.STATE_NAME}`),console.log("about to view.goTo target: feature.geometry.extent, padding: 50..."),a.goTo({target:e.geometry.extent,padding:50});const i=document.getElementById("selectionCountBtn");i.textContent=n+1+" of "+t.length,h(e),console.log(`Touring state ${n+1} of ${t.length}: ${e.attributes.STATE_NAME}`),n++,gtag("event","click",{event_category:"Toolbar",event_label:`Tour: ${e.attributes.STATE_NAME}`,value:n})});document.getElementById("tourBackButton").addEventListener("click",()=>{const t=window._selectedStates||[];if(!t.length){alert("No selected states to tour.");return}n<=0?n=t.length-1:n--;const e=t[n];if(!e||!e.geometry||!e.geometry.extent){console.error("Invalid feature in reverse tour:",n,e);return}a.goTo({target:e.geometry.extent,padding:50}),h(e),console.log(`Touring state ${n+1} of ${t.length}: ${e.attributes.STATE_NAME}`),document.getElementById("selectionCountBtn").textContent=n+1+" of "+t.length,gtag("event","click",{event_category:"Toolbar",event_label:`Back Tour: ${e.attributes.STATE_NAME}`,value:n})});document.getElementById("extentBackButton").addEventListener("click",()=>{c>0&&(c--,a.goTo(g[c]))});document.getElementById("extentForwardButton").addEventListener("click",()=>{c<g.length-1&&(c++,a.goTo(g[c]))});
